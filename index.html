<!DOCTYPE html>
<html>
<head>
<title>Catch the Red Square - Mobile + Admin</title>
<style>
body { margin:0; background:#222; color:white; text-align:center; font-family:sans-serif; }
canvas { background:#000; display:block; margin:20px auto; border:2px solid white; }

/* Mobile buttons */
button.control {
  position: fixed;
  width: 60px;
  height: 60px;
  font-size: 18px;
  opacity: 0.7;
  z-index: 999;
}

/* Hide mobile buttons on PC */
@media screen and (min-width: 768px) {
  button.control { display: none; }
}

/* Show mobile buttons on phones/tablets */
@media screen and (max-width: 767px) {
  #up { bottom: 120px; left: 80px; }
  #down { bottom: 0px; left: 80px; }
  #left { bottom: 60px; left: 20px; }
  #right { bottom: 60px; left: 140px; }
}

/* Admin panel */
#adminPanel {
  position: fixed;
  bottom: 10px;
  left: 10px;
  background: rgba(0,0,0,0.6);
  border: 1px solid white;
  border-radius: 8px;
  padding: 5px;
  z-index: 1000;
}
#cmd { padding:5px; }
</style>
</head>
<body>

<h1>Catch the Red Square!</h1>

<!-- Admin panel visible -->
<div id="adminPanel">
  <input id="cmd" placeholder="admin command...">
  <button onclick="runCmd()">Run</button>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<!-- Mobile controls -->
<button id="up" class="control">↑</button>
<button id="down" class="control">↓</button>
<button id="left" class="control">←</button>
<button id="right" class="control">→</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let player = {x:180, y:180, size:40};
let target = {x:Math.random()*360, y:Math.random()*360, size:30};
let score = 0;

let playerSpeed = 10;
let targetColor = 'yellow';
let frozen = false;

// -----------------------
// Admin password setup
let admin = false;
// SHA-256 hash of password "mypassword123"
const adminHash = "ef92b778ba3e3dbb9f06c6d84a25ffef0b83a3dc091b2fa1b1397e69c4b8f5f3";

// check password function
async function checkPassword(input) {
    const msgBuffer = new TextEncoder().encode(input);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
    return hashHex === adminHash;
}

// -----------------------
// RUN ADMIN COMMANDS
async function runCmd() {
    let input = document.getElementById("cmd").value.trim();
    if(!input) return;

    if(!admin) {
        let pw = prompt("Enter admin password:");
        if(await checkPassword(pw)) {
            admin = true;
            alert("Admin access granted!");
        } else {
            alert("Wrong password!");
            document.getElementById("cmd").value = "";
            return;
        }
    }

    let parts = input.split(" ");
    let cmd = parts[0].toLowerCase();
    let arg = parts[1];

    switch(cmd) {
        case "speed": playerSpeed = 20; break;
        case "slow": playerSpeed = 10; break;
        case "tp": target.x = Math.random()*360; target.y = Math.random()*360; break;
        case "color": if(arg) targetColor = arg; break;
        case "size": if(arg && !isNaN(parseInt(arg))) player.size = parseInt(arg); break;
        case "score": if(arg && !isNaN(parseInt(arg))) score = parseInt(arg); break;
        case "freeze": frozen = true; break;
        case "spawn": alert("Spawn command not implemented yet"); break;
        case "reset": 
            player.x=180; player.y=180;
            target.x=Math.random()*360; target.y=Math.random()*360;
            score=0; frozen=false;
            break;
        case "god": alert("God mode activated! (placeholder)"); break;
        default: alert("Unknown command!");
    }

    document.getElementById("cmd").value = "";
    draw();
}

// -----------------------
// MOBILE BUTTON CONTROLS (only for touch)
document.getElementById("up").addEventListener('touchstart', () => { player.y -= playerSpeed; });
document.getElementById("down").addEventListener('touchstart', () => { player.y += playerSpeed; });
document.getElementById("left").addEventListener('touchstart', () => { player.x -= playerSpeed; });
document.getElementById("right").addEventListener('touchstart', () => { player.x += playerSpeed; });

// -----------------------
// KEYBOARD CONTROLS remain unchanged

// -----------------------
// GAME LOOP
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // player
    ctx.fillStyle='red';
    ctx.fillRect(player.x, player.y, player.size, player.size);

    // target
    ctx.fillStyle = targetColor;
    ctx.fillRect(target.x, target.y, target.size, target.size);

    // score
    ctx.fillStyle='white';
    ctx.font='20px sans-serif';
    ctx.fillText('Score: ' + score, 10, 20);
}

function update() {
    if(!frozen && player.x < target.x + target.size &&
       player.x + player.size > target.x &&
       player.y < target.y + target.size &&
       player.y + player.size > target.y){
        score++;
        target.x = Math.random()*360;
        target.y = Math.random()*360;
    }

    player.x = Math.max(0, Math.min(400-player.size, player.x));
    player.y = Math.max(0, Math.min(400-player.size, player.y));
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();
</script>

</body>
</html>

